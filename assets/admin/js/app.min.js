/*! pojo-places - v1.0.0 - 30-09-2014 */
var Pojo_Places_Admin=Pojo_Places_Admin||{};!function(a,b){"use strict";Pojo_Places_Admin.App={getLocation:function(a,b){return new google.maps.LatLng(a,b)},cache:{$document:a(document),$window:a(window)},cacheElements:function(){this.cache.$body=a("body"),this.cache.$addressWrapper=a("#pojo-places-address"),this.cache.fields={$address:this.$("div.atmb-field-row.atmb-address input.atmb-field-text"),$city:this.$("div.atmb-field-row.atmb-city input.atmb-field-text"),$zipcode:this.$("div.atmb-field-row.atmb-zipcode input.atmb-field-text"),$country:this.$("div.atmb-field-row.atmb-country input.atmb-field-text"),$latitude:this.$("div.atmb-field-row.atmb-latitude input.atmb-field-text"),$longitude:this.$("div.atmb-field-row.atmb-longitude input.atmb-field-text")},this.cache.settingFields={$addressLine:a("#places_start_point_text"),$geoLocation:a("#places_start_point_geo")}},$:function(a){return this.cache.$addressWrapper.find(a)},buildElements:function(){var a=this;if(1<=a.cache.$addressWrapper.length&&(a.$("div.atmb-wrap-fields").append('<div class="atmb-field-row"><button class="button" id="pojo-lookup-location">Preview</button></div><div id="pojo-google-map-wrap"></div>'),a.cache.$map=a.$("#pojo-google-map-wrap"),a.cache.$lookupLocation=a.$("#pojo-lookup-location"),a.geocoder=new google.maps.Geocoder,a.bindMapEvents()),1<=a.cache.settingFields.$addressLine.length){a.geocoder=new google.maps.Geocoder;var c=new google.maps.places.Autocomplete(a.cache.settingFields.$addressLine[0],{types:["geocode"]});google.maps.event.addListener(c,"place_changed",function(){var d=c.getPlace().geometry;b!==d&&a.cache.settingFields.$geoLocation.val(d.location.lat()+";"+d.location.lng())})}},bindMapEvents:function(){var a=this;a.cache.$map.css({width:"100%",height:"200px",marginTop:"10px"});var b;b=a.cache.fields.$latitude.val().length>0&&a.cache.fields.$longitude.val().length>0?a.getLocation(a.cache.fields.$latitude.val(),a.cache.fields.$longitude.val()):a.getLocation(POJO_ADMIN.places.lat,POJO_ADMIN.places.lng),a.adminMap=new google.maps.Map(document.getElementById("pojo-google-map-wrap"),{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:15,center:b,streetViewControl:!1,zoomControl:!0,panControl:!0,scaleControl:!0}),a.marker=new google.maps.Marker({position:b,map:a.adminMap,draggable:!0,animation:google.maps.Animation.DROP}),google.maps.event.addListener(a.marker,"dragend",function(){a._changePosition(a.marker.getPosition())}),a.cache.$lookupLocation.on("click",function(b){b.preventDefault();var c=a.cache.fields.$address.val(),d=a.cache.fields.$city.val(),e=a.cache.fields.$zipcode.val(),f=a.cache.fields.$country.val(),g=[c,d,e,f].filter(Boolean).join(", ");a.geocoder.geocode({address:g},function(b,c){if(c===google.maps.GeocoderStatus.OK){var d=b[0].geometry.location;a.cache.fields.$latitude.val(d.lat()),a.cache.fields.$longitude.val(d.lng()),a._changePosition(d,!0)}})})},bindEvents:function(){},_changePosition:function(a,b){b=b||!1,this.cache.fields.$latitude.val(a.lat()),this.cache.fields.$longitude.val(a.lng()),b&&(this.adminMap.setCenter(a),this.marker.setPosition(a))},init:function(){this.cacheElements(),this.buildElements(),this.bindEvents()}},a(document).ready(function(){Pojo_Places_Admin.App.init()})}(jQuery);