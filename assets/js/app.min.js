var pojoPlaces=pojoPlaces||{};pojoPlaces.utils=pojoPlaces.utils||{},function(){"use strict";pojoPlaces.utils.GoogleApi={getDistance:function(a,b,c){return google.maps.geometry.spherical.computeDistanceBetween(c,this.getLocation(a,b))/10},getLocation:function(a,b){return new google.maps.LatLng(a,b)}}}(jQuery);var pojoPlaces=pojoPlaces||{};pojoPlaces.views=pojoPlaces.views||{},function(a,b){"use strict";pojoPlaces.views.AppView=Backbone.View.extend({el:"#pojo-places",events:{"click button.get-geolocation-position":"_getLocationGetPosition"},initialize:function(){var a=this;a.google_api=pojoPlaces.utils.GoogleApi,a.geocoder=new google.maps.Geocoder,a.$places_ul=a.$("ul.places"),a.$places=a.$places_ul.find("li.place"),a.$loading=a.$("div.loading"),a.$search_wrap=a.$("div.search-wrap"),a.$search_box=a.$search_wrap.find("input.search-box"),a.userLocation=a.google_api.getLocation(32.07,34.77),a._googleListener(),a.render()},_getLocationGetPosition:function(){var a=pojoPlaces.App;navigator.geolocation.getCurrentPosition(function(b){a.$loading.show(),a.userLocation=a.google_api.getLocation(b.coords.latitude,b.coords.longitude),a.geocoder.geocode({latLng:a.userLocation},function(b,c){c==google.maps.GeocoderStatus.OK&&b[0]&&a.$search_box.val(b[0].formatted_address),a.$loading.hide()}),a.render()})},_googleListener:function(){var a=this,c=new google.maps.places.Autocomplete(a.$search_box[0],{types:["geocode"]});google.maps.event.addListener(c,"place_changed",function(){var d=c.getPlace().geometry;b!==d&&(a.userLocation=d.location,a.render())}),Modernizr.geolocation&&a.$("button.get-geolocation-position").show()},render:function(){var b=this;b.$places.each(function(){var c=Math.round(b.google_api.getDistance(Number(a(this).data("latitude")),Number(a(this).data("longitude")),b.userLocation));a(this).data("distance",c).find(".dist-debug").html("dist: "+c)}),b.$places.sort(function(b,c){var d=parseInt(a(b).data("distance")),e=parseInt(a(c).data("distance"));return e>d?-1:d>e?1:0}),b.$places_ul.append(b.$places)}})}(jQuery);var pojoPlaces=pojoPlaces||{};jQuery(document).ready(function(){"use strict";pojoPlaces.App=new pojoPlaces.views.AppView});